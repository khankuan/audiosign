function setupTypedArray(a,b){"function"!=typeof this[a]&&"object"!=typeof this[a]&&(this[a]="function"==typeof this[b]&&"object"!=typeof this[b]?this[b]:function(a){return a instanceof Array?a:"number"==typeof a?new Array(a):void 0})}function FourierTransform(a,b){this.bufferSize=a,this.sampleRate=b,this.bandwidth=2/a*b/2,this.spectrum=new Float32Array(a/2),this.real=new Float32Array(a),this.imag=new Float32Array(a),this.peakBand=0,this.peak=0,this.getBandFrequency=function(a){return this.bandwidth*a+this.bandwidth/2},this.calculateSpectrum=function(){for(var b,c,d,e=this.spectrum,f=this.real,g=this.imag,h=2/this.bufferSize,i=Math.sqrt,j=0,k=a/2;k>j;j++)b=f[j],c=g[j],d=h*i(b*b+c*c),d>this.peak&&(this.peakBand=j,this.peak=d),e[j]=d}}function DFT(a,b){FourierTransform.call(this,a,b);var c=a/2*a,d=2*Math.PI;this.sinTable=new Float32Array(c),this.cosTable=new Float32Array(c);for(var e=0;c>e;e++)this.sinTable[e]=Math.sin(e*d/a),this.cosTable[e]=Math.cos(e*d/a)}function FFT(a,b){FourierTransform.call(this,a,b),this.reverseTable=new Uint32Array(a);for(var c,d=1,e=a>>1;a>d;){for(c=0;d>c;c++)this.reverseTable[c+d]=this.reverseTable[c]+e;d<<=1,e>>=1}for(this.sinTable=new Float32Array(a),this.cosTable=new Float32Array(a),c=0;a>c;c++)this.sinTable[c]=Math.sin(-Math.PI/c),this.cosTable[c]=Math.cos(-Math.PI/c)}function RFFT(a,b){FourierTransform.call(this,a,b),this.trans=new Float32Array(a),this.reverseTable=new Uint32Array(a),this.reverseBinPermute=function(a,b){var c,d=this.bufferSize,e=d>>>1,f=d-1,g=1,h=0;a[0]=b[0];do{for(h+=e,a[g]=b[h],a[h]=b[g],g++,c=e<<1;c>>=1,!((h^=c)&c););h>=g&&(a[g]=b[h],a[h]=b[g],a[f-g]=b[f-h],a[f-h]=b[f-g]),g++}while(e>g);a[f]=b[f]},this.generateReverseTable=function(){var a,b=this.bufferSize,c=b>>>1,d=b-1,e=1,f=0;this.reverseTable[0]=0;do{for(f+=c,this.reverseTable[e]=f,this.reverseTable[f]=e,e++,a=c<<1;a>>=1,!((f^=a)&a););f>=e&&(this.reverseTable[e]=f,this.reverseTable[f]=e,this.reverseTable[d-e]=d-f,this.reverseTable[d-f]=d-e),e++}while(c>e);this.reverseTable[d]=d},this.generateReverseTable()}function Sampler(a,b,c,d,e,f,g,h){this.file=a,this.bufferSize=b,this.sampleRate=c,this.playStart=d||0,this.playEnd=e||1,this.loopStart=f||0,this.loopEnd=g||1,this.loopMode=h||DSP.OFF,this.loaded=!1,this.samples=[],this.signal=new Float32Array(b),this.frameCount=0,this.envelope=null,this.amplitude=1,this.rootFrequency=110,this.frequency=550,this.step=this.frequency/this.rootFrequency,this.duration=0,this.samplesProcessed=0,this.playhead=0;var i=document.createElement("AUDIO"),j=this;this.loadSamples=function(a){for(var b=DSP.getChannel(DSP.MIX,a.frameBuffer),c=0;c<b.length;c++)j.samples.push(b[c])},this.loadComplete=function(){j.samples=new Float32Array(j.samples),j.loaded=!0},this.loadMetaData=function(){j.duration=i.duration},i.addEventListener("MozAudioAvailable",this.loadSamples,!1),i.addEventListener("loadedmetadata",this.loadMetaData,!1),i.addEventListener("ended",this.loadComplete,!1),i.muted=!0,i.src=a,i.play()}function Oscillator(a,b,c,d,e){switch(this.frequency=b,this.amplitude=c,this.bufferSize=d,this.sampleRate=e,this.frameCount=0,this.waveTableLength=2048,this.cyclesPerSample=b/e,this.signal=new Float32Array(d),this.envelope=null,parseInt(a,10)){case DSP.TRIANGLE:this.func=Oscillator.Triangle;break;case DSP.SAW:this.func=Oscillator.Saw;break;case DSP.SQUARE:this.func=Oscillator.Square;break;default:case DSP.SINE:this.func=Oscillator.Sine}this.generateWaveTable=function(){Oscillator.waveTable[this.func]=new Float32Array(2048);for(var a=this.waveTableLength/this.sampleRate,b=1/a,c=0;c<this.waveTableLength;c++)Oscillator.waveTable[this.func][c]=this.func(c*b/this.sampleRate)},"undefined"==typeof Oscillator.waveTable&&(Oscillator.waveTable={}),"undefined"==typeof Oscillator.waveTable[this.func]&&this.generateWaveTable(),this.waveTable=Oscillator.waveTable[this.func]}function ADSR(a,b,c,d,e,f){this.sampleRate=f,this.attackLength=a,this.decayLength=b,this.sustainLevel=c,this.sustainLength=d,this.releaseLength=e,this.sampleRate=f,this.attackSamples=a*f,this.decaySamples=b*f,this.sustainSamples=d*f,this.releaseSamples=e*f,this.update=function(){this.attack=this.attackSamples,this.decay=this.attack+this.decaySamples,this.sustain=this.decay+this.sustainSamples,this.release=this.sustain+this.releaseSamples},this.update(),this.samplesProcessed=0}function IIRFilter(a,b,c,d){switch(this.sampleRate=d,a){case DSP.LOWPASS:case DSP.LP12:this.func=new IIRFilter.LP12(b,c,d)}}function IIRFilter2(a,b,c,d){this.type=a,this.cutoff=b,this.resonance=c,this.sampleRate=d,this.f=Float32Array(4),this.f[0]=0,this.f[1]=0,this.f[2]=0,this.f[3]=0,this.calcCoeff=function(a,b){this.freq=2*Math.sin(Math.PI*Math.min(.25,a/(2*this.sampleRate))),this.damp=Math.min(2*(1-Math.pow(b,.25)),Math.min(2,2/this.freq-.5*this.freq))},this.calcCoeff(b,c)}function WindowFunction(a,b){switch(this.alpha=b,a){case DSP.BARTLETT:this.func=WindowFunction.Bartlett;break;case DSP.BARTLETTHANN:this.func=WindowFunction.BartlettHann;break;case DSP.BLACKMAN:this.func=WindowFunction.Blackman,this.alpha=this.alpha||.16;break;case DSP.COSINE:this.func=WindowFunction.Cosine;break;case DSP.GAUSS:this.func=WindowFunction.Gauss,this.alpha=this.alpha||.25;break;case DSP.HAMMING:this.func=WindowFunction.Hamming;break;case DSP.HANN:this.func=WindowFunction.Hann;break;case DSP.LANCZOS:this.func=WindowFunction.Lanczoz;break;case DSP.RECTANGULAR:this.func=WindowFunction.Rectangular;break;case DSP.TRIANGULAR:this.func=WindowFunction.Triangular}}function sinh(a){return(Math.exp(a)-Math.exp(-a))/2}function Biquad(a,b){this.Fs=b,this.type=a,this.parameterType=DSP.Q,this.x_1_l=0,this.x_2_l=0,this.y_1_l=0,this.y_2_l=0,this.x_1_r=0,this.x_2_r=0,this.y_1_r=0,this.y_2_r=0,this.b0=1,this.a0=1,this.b1=0,this.a1=0,this.b2=0,this.a2=0,this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0,this.f0=3e3,this.dBgain=12,this.Q=1,this.BW=-3,this.S=1,this.coefficients=function(){var a=[this.b0,this.b1,this.b2],b=[this.a0,this.a1,this.a2];return{b:a,a:b}},this.setFilterType=function(a){this.type=a,this.recalculateCoefficients()},this.setSampleRate=function(a){this.Fs=a,this.recalculateCoefficients()},this.setQ=function(a){this.parameterType=DSP.Q,this.Q=Math.max(Math.min(a,115),.001),this.recalculateCoefficients()},this.setBW=function(a){this.parameterType=DSP.BW,this.BW=a,this.recalculateCoefficients()},this.setS=function(a){this.parameterType=DSP.S,this.S=Math.max(Math.min(a,5),1e-4),this.recalculateCoefficients()},this.setF0=function(a){this.f0=a,this.recalculateCoefficients()},this.setDbGain=function(a){this.dBgain=a,this.recalculateCoefficients()},this.recalculateCoefficients=function(){var b;b=a===DSP.PEAKING_EQ||a===DSP.LOW_SHELF||a===DSP.HIGH_SHELF?Math.pow(10,this.dBgain/40):Math.sqrt(Math.pow(10,this.dBgain/20));var c=DSP.TWO_PI*this.f0/this.Fs,d=Math.cos(c),e=Math.sin(c),f=0;switch(this.parameterType){case DSP.Q:f=e/(2*this.Q);break;case DSP.BW:f=e*sinh(Math.LN2/2*this.BW*c/e);break;case DSP.S:f=e/2*Math.sqrt((b+1/b)*(1/this.S-1)+2)}var g;switch(this.type){case DSP.LPF:this.b0=(1-d)/2,this.b1=1-d,this.b2=(1-d)/2,this.a0=1+f,this.a1=-2*d,this.a2=1-f;break;case DSP.HPF:this.b0=(1+d)/2,this.b1=-(1+d),this.b2=(1+d)/2,this.a0=1+f,this.a1=-2*d,this.a2=1-f;break;case DSP.BPF_CONSTANT_SKIRT:this.b0=e/2,this.b1=0,this.b2=-e/2,this.a0=1+f,this.a1=-2*d,this.a2=1-f;break;case DSP.BPF_CONSTANT_PEAK:this.b0=f,this.b1=0,this.b2=-f,this.a0=1+f,this.a1=-2*d,this.a2=1-f;break;case DSP.NOTCH:this.b0=1,this.b1=-2*d,this.b2=1,this.a0=1+f,this.a1=-2*d,this.a2=1-f;break;case DSP.APF:this.b0=1-f,this.b1=-2*d,this.b2=1+f,this.a0=1+f,this.a1=-2*d,this.a2=1-f;break;case DSP.PEAKING_EQ:this.b0=1+f*b,this.b1=-2*d,this.b2=1-f*b,this.a0=1+f/b,this.a1=-2*d,this.a2=1-f/b;break;case DSP.LOW_SHELF:g=e*Math.sqrt((3^b)*(1/this.S-1)+2*b),this.b0=b*(b+1-(b-1)*d+g),this.b1=2*b*(b-1-(b+1)*d),this.b2=b*(b+1-(b-1)*d-g),this.a0=b+1+(b-1)*d+g,this.a1=-2*(b-1+(b+1)*d),this.a2=b+1+(b-1)*d-g;break;case DSP.HIGH_SHELF:g=e*Math.sqrt((3^b)*(1/this.S-1)+2*b),this.b0=b*(b+1+(b-1)*d+g),this.b1=-2*b*(b-1+(b+1)*d),this.b2=b*(b+1+(b-1)*d-g),this.a0=b+1-(b-1)*d+g,this.a1=2*(b-1-(b+1)*d),this.a2=b+1-(b-1)*d-g}this.b0a0=this.b0/this.a0,this.b1a0=this.b1/this.a0,this.b2a0=this.b2/this.a0,this.a1a0=this.a1/this.a0,this.a2a0=this.a2/this.a0},this.process=function(a){for(var b=a.length,c=new Float32Array(b),d=0;d<a.length;d++)c[d]=this.b0a0*a[d]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=c[d],this.x_2_l=this.x_1_l,this.x_1_l=a[d];return c},this.processStereo=function(a){for(var b=a.length,c=new Float32Array(b),d=0;b/2>d;d++)c[2*d]=this.b0a0*a[2*d]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l,this.y_2_l=this.y_1_l,this.y_1_l=c[2*d],this.x_2_l=this.x_1_l,this.x_1_l=a[2*d],c[2*d+1]=this.b0a0*a[2*d+1]+this.b1a0*this.x_1_r+this.b2a0*this.x_2_r-this.a1a0*this.y_1_r-this.a2a0*this.y_2_r,this.y_2_r=this.y_1_r,this.y_1_r=c[2*d+1],this.x_2_r=this.x_1_r,this.x_1_r=a[2*d+1];return c}}function GraphicalEq(a){this.FS=a,this.minFreq=40,this.maxFreq=16e3,this.bandsPerOctave=1,this.filters=[],this.freqzs=[],this.calculateFreqzs=!0,this.recalculateFilters=function(){var a=Math.round(Math.log(this.maxFreq/this.minFreq)*this.bandsPerOctave/Math.LN2);this.filters=[];for(var b=0;a>b;b++){var c=this.minFreq*Math.pow(2,b/this.bandsPerOctave),d=new Biquad(DSP.PEAKING_EQ,this.FS);d.setDbGain(0),d.setBW(1/this.bandsPerOctave),d.setF0(c),this.filters[b]=d,this.recalculateFreqz(b)}},this.setMinimumFrequency=function(a){this.minFreq=a,this.recalculateFilters()},this.setMaximumFrequency=function(a){this.maxFreq=a,this.recalculateFilters()},this.setBandsPerOctave=function(a){this.bandsPerOctave=a,this.recalculateFilters()},this.setBandGain=function(a,b){if(0>a||a>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds.";if(!b)throw"A gain must be passed.";this.filters[a].setDbGain(b),this.recalculateFreqz(a)},this.recalculateFreqz=function(a){if(this.calculateFreqzs){if(0>a||a>this.filters.length-1)throw"The band index of the graphical equalizer is out of bounds. "+a+" is out of [0, "+this.filters.length-1+"]";if(!this.w){this.w=Float32Array(400);for(var b=0;b<this.w.length;b++)this.w[b]=Math.PI/this.w.length*b}var c=[this.filters[a].b0,this.filters[a].b1,this.filters[a].b2],d=[this.filters[a].a0,this.filters[a].a1,this.filters[a].a2];this.freqzs[a]=DSP.mag2db(DSP.freqz(c,d,this.w))}},this.process=function(a){for(var b=a,c=0;c<this.filters.length;c++)b=this.filters[c].process(b);return b},this.processStereo=function(a){for(var b=a,c=0;c<this.filters.length;c++)b=this.filters[c].processStereo(b);return b}}function MultiDelay(a,b,c,d){this.delayBufferSamples=new Float32Array(a),this.delayInputPointer=b,this.delayOutputPointer=0,this.delayInSamples=b,this.masterVolume=c,this.delayVolume=d}function SingleDelay(a,b,c){this.delayBufferSamples=new Float32Array(a),this.delayInputPointer=b,this.delayOutputPointer=0,this.delayInSamples=b,this.delayVolume=c}function Reverb(a,b,c,d,e,f){this.delayInSamples=b,this.masterVolume=c,this.mixVolume=d,this.delayVolume=e,this.dampFrequency=f,this.NR_OF_MULTIDELAYS=6,this.NR_OF_SINGLEDELAYS=6,this.LOWPASSL=new IIRFilter2(DSP.LOWPASS,f,0,44100),this.LOWPASSR=new IIRFilter2(DSP.LOWPASS,f,0,44100),this.singleDelays=[];var g,h;for(g=0;g<this.NR_OF_SINGLEDELAYS;g++)h=1+g/7,this.singleDelays[g]=new SingleDelay(a,Math.round(this.delayInSamples*h),this.delayVolume);for(this.multiDelays=[],g=0;g<this.NR_OF_MULTIDELAYS;g++)h=1+g/10,this.multiDelays[g]=new MultiDelay(a,Math.round(this.delayInSamples*h),this.masterVolume,this.delayVolume)}!function(){function a(a,b){return u[255&(a^b)]}function b(a,b){return v[255&(a^b)]^a>>8&255}function c(a,b){return w[255&(a>>8^b)]^a<<8&65535}function d(a,b){return x[255&(a^b)]^a>>8&255}function e(a,b){return y[255&(a^b)]^a>>8&16777215}function f(b){for(var c=b.length,d=0,e=0;c>e;e++)d=a(d,b.charCodeAt(e));return d}function g(b){for(var c=0,d=0,e=b.length;e>d;++d)c=a(c,b[d]);return c}function h(a){var c,d=a.length,e=0;for(c=0;d>c;c++)e=b(e,a.charCodeAt(c));return e}function i(a){var c,d=a.length,e=65535;for(c=0;d>c;c++)e=b(e,a.charCodeAt(c));return e}function j(a){for(var c=65535,d=0,e=a.length;e>d;++d)c=b(c,a[d]);return c}function k(a){var b,d=a.length,e=0;for(b=0;d>b;b++)e=c(e,a.charCodeAt(b));return e}function l(a){for(var b=0,d=0,e=a.length;e>d;++d)b=c(b,a[d]);return b}function m(a){var b,c=a.length,e=65535;for(b=0;c>b;b++)e=d(e,a.charCodeAt(b));return 65535^e}function n(a){var b,c=a.length,d=4294967295;for(b=0;c>b;b++)d=e(d,a.charCodeAt(b));return 4294967295^d}function o(a){for(var b=4294967295,c=0,d=a.length;d>c;++c)b=e(b,a[c]);return 4294967295^b}function p(a){for(var b=255&a,c=b.toString(16).toUpperCase();c.length<2;)c="0"+c;return c}function q(a){return p(a>>8)+p(a)}function r(a){return q(a>>16)+q(a)}var s,t,u=new Array(0,27,54,45,108,119,90,65,216,195,238,245,180,175,130,153,211,200,229,254,191,164,137,146,11,16,61,38,103,124,81,74,197,222,243,232,169,178,159,132,29,6,43,48,113,106,71,92,22,13,32,59,122,97,76,87,206,213,248,227,162,185,148,143,233,242,223,196,133,158,179,168,49,42,7,28,93,70,107,112,58,33,12,23,86,77,96,123,226,249,212,207,142,149,184,163,44,55,26,1,64,91,118,109,244,239,194,217,152,131,174,181,255,228,201,210,147,136,165,190,39,60,17,10,75,80,125,102,177,170,135,156,221,198,235,240,105,114,95,68,5,30,51,40,98,121,84,79,14,21,56,35,186,161,140,151,214,205,224,251,116,111,66,89,24,3,46,53,172,183,154,129,192,219,246,237,167,188,145,138,203,208,253,230,127,100,73,82,19,8,37,62,88,67,110,117,52,47,2,25,128,155,182,173,236,247,218,193,139,144,189,166,231,252,209,202,83,72,101,126,63,36,9,18,157,134,171,176,241,234,199,220,69,94,115,104,41,50,31,4,78,85,120,99,34,57,20,15,150,141,160,187,250,225,204,215),v=new Array(0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448),w=new Array(0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920),x=new Array(0,4489,8978,12955,17956,22445,25910,29887,35912,40385,44890,48851,51820,56293,59774,63735,4225,264,13203,8730,22181,18220,30135,25662,40137,36160,49115,44626,56045,52068,63999,59510,8450,12427,528,5017,26406,30383,17460,21949,44362,48323,36440,40913,60270,64231,51324,55797,12675,8202,4753,792,30631,26158,21685,17724,48587,44098,40665,36688,64495,60006,55549,51572,16900,21389,24854,28831,1056,5545,10034,14011,52812,57285,60766,64727,34920,39393,43898,47859,21125,17164,29079,24606,5281,1320,14259,9786,57037,53060,64991,60502,39145,35168,48123,43634,25350,29327,16404,20893,9506,13483,1584,6073,61262,65223,52316,56789,43370,47331,35448,39921,29575,25102,20629,16668,13731,9258,5809,1848,65487,60998,56541,52564,47595,43106,39673,35696,33800,38273,42778,46739,49708,54181,57662,61623,2112,6601,11090,15067,20068,24557,28022,31999,38025,34048,47003,42514,53933,49956,61887,57398,6337,2376,15315,10842,24293,20332,32247,27774,42250,46211,34328,38801,58158,62119,49212,53685,10562,14539,2640,7129,28518,32495,19572,24061,46475,41986,38553,34576,62383,57894,53437,49460,14787,10314,6865,2904,32743,28270,23797,19836,50700,55173,58654,62615,32808,37281,41786,45747,19012,23501,26966,30943,3168,7657,12146,16123,54925,50948,62879,58390,37033,33056,46011,41522,23237,19276,31191,26718,7393,3432,16371,11898,59150,63111,50204,54677,41258,45219,33336,37809,27462,31439,18516,23005,11618,15595,3696,8185,63375,58886,54429,50452,45483,40994,37561,33584,31687,27214,22741,18780,15843,11370,7921,3960),y=new Array(0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117);"undefined"==typeof window?(s=module,t="exports"):(s=window,t="crc"),s[t]={crc8:f,crcArc:h,crcModbusString:i,crcModbusHex:j,crc16:k,fcs16:m,crc32:n,hex8:p,hex16:q,hex32:r,buffer:{crc8:g,crc16:l,crc32:o}}}();var DSP={LEFT:0,RIGHT:1,MIX:2,SINE:1,TRIANGLE:2,SAW:3,SQUARE:4,LOWPASS:0,HIGHPASS:1,BANDPASS:2,NOTCH:3,BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10,OFF:0,FW:1,BW:2,FWBW:3,TWO_PI:2*Math.PI};setupTypedArray("Float32Array","WebGLFloatArray"),setupTypedArray("Int32Array","WebGLIntArray"),setupTypedArray("Uint16Array","WebGLUnsignedShortArray"),setupTypedArray("Uint8Array","WebGLUnsignedByteArray"),DSP.invert=function(a){for(var b=0,c=a.length;c>b;b++)a[b]*=-1;return a},DSP.interleave=function(a,b){if(a.length!==b.length)throw"Can not interleave. Channel lengths differ.";for(var c=new Float32Array(2*a.length),d=0,e=a.length;e>d;d++)c[2*d]=a[d],c[2*d+1]=b[d];return c},DSP.deinterleave=function(){var a,b,c,d=[];return d[DSP.MIX]=function(a){for(var b=0,d=a.length/2;d>b;b++)c[b]=(a[2*b]+a[2*b+1])/2;return c},d[DSP.LEFT]=function(b){for(var c=0,d=b.length/2;d>c;c++)a[c]=b[2*c];return a},d[DSP.RIGHT]=function(a){for(var c=0,d=a.length/2;d>c;c++)b[c]=a[2*c+1];return b},function(e,f){return a=a||new Float32Array(f.length/2),b=b||new Float32Array(f.length/2),c=c||new Float32Array(f.length/2),f.length/2!==a.length&&(a=new Float32Array(f.length/2),b=new Float32Array(f.length/2),c=new Float32Array(f.length/2)),d[e](f)}}(),DSP.getChannel=DSP.deinterleave,DSP.mixSampleBuffers=function(a,b,c,d){for(var e=new Float32Array(a),f=0;f<a.length;f++)e[f]+=(c?-b[f]:b[f])/d;return e},DSP.LPF=0,DSP.HPF=1,DSP.BPF_CONSTANT_SKIRT=2,DSP.BPF_CONSTANT_PEAK=3,DSP.NOTCH=4,DSP.APF=5,DSP.PEAKING_EQ=6,DSP.LOW_SHELF=7,DSP.HIGH_SHELF=8,DSP.Q=1,DSP.BW=2,DSP.S=3,DSP.RMS=function(a){for(var b=0,c=0,d=a.length;d>c;c++)b+=a[c]*a[c];return Math.sqrt(b/d)},DSP.Peak=function(a){for(var b=0,c=0,d=a.length;d>c;c++)b=Math.abs(a[c])>b?Math.abs(a[c]):b;return b},DFT.prototype.forward=function(a){for(var b,c,d=this.real,e=this.imag,f=0;f<this.bufferSize/2;f++){b=0,c=0;for(var g=0;g<a.length;g++)b+=this.cosTable[f*g]*a[g],c+=this.sinTable[f*g]*a[g];d[f]=b,e[f]=c}return this.calculateSpectrum()},FFT.prototype.forward=function(a){var b=this.bufferSize,c=this.cosTable,d=this.sinTable,e=this.reverseTable,f=this.real,g=this.imag,h=(this.spectrum,Math.floor(Math.log(b)/Math.LN2));if(Math.pow(2,h)!==b)throw"Invalid buffer size, must be a power of 2.";if(b!==a.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+b+" Buffer Size: "+a.length;var i,j,k,l,m,n,o,p,q,r=1;for(q=0;b>q;q++)f[q]=a[e[q]],g[q]=0;for(;b>r;){i=c[r],j=d[r],k=1,l=0;for(var s=0;r>s;s++){for(q=s;b>q;)m=q+r,n=k*f[m]-l*g[m],o=k*g[m]+l*f[m],f[m]=f[q]-n,g[m]=g[q]-o,f[q]+=n,g[q]+=o,q+=r<<1;p=k,k=p*i-l*j,l=p*j+l*i}r<<=1}return this.calculateSpectrum()},FFT.prototype.inverse=function(a,b){{var c=this.bufferSize,d=this.cosTable,e=this.sinTable,f=this.reverseTable;this.spectrum}a=a||this.real,b=b||this.imag;var g,h,i,j,k,l,m,n,o,p=1;for(o=0;c>o;o++)b[o]*=-1;var q=new Float32Array(c),r=new Float32Array(c);for(o=0;o<a.length;o++)q[o]=a[f[o]],r[o]=b[f[o]];for(a=q,b=r;c>p;){g=d[p],h=e[p],i=1,j=0;for(var s=0;p>s;s++){for(o=s;c>o;)k=o+p,l=i*a[k]-j*b[k],m=i*b[k]+j*a[k],a[k]=a[o]-l,b[k]=b[o]-m,a[o]+=l,b[o]+=m,o+=p<<1;n=i,i=n*g-j*h,j=n*h+j*g}p<<=1}var t=new Float32Array(c);for(o=0;c>o;o++)t[o]=a[o]/c;return t},RFFT.prototype.forward=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=this.bufferSize,C=this.spectrum,D=this.trans,E=2*Math.PI,F=Math.sqrt,G=B>>>1,H=2/B;this.reverseBinPermute(D,a);for(var I=0,J=4;B>I;J*=4){for(var K=I;B>K;K+=J)r=D[K]-D[K+1],D[K]+=D[K+1],D[K+1]=r;I=2*(J-1)}for(b=2,e=B>>>1;e>>>=1;){I=0,b<<=1,J=b<<1,c=b>>>2,d=b>>>3;do{if(1!==c)for(K=I;B>K;K+=J)j=K,k=j+c,l=k+c,m=l+c,f=D[l]+D[m],D[m]-=D[l],D[l]=D[j]-f,D[j]+=f,j+=d,k+=d,l+=d,m+=d,f=D[l]+D[m],g=D[l]-D[m],f=-f*Math.SQRT1_2,g*=Math.SQRT1_2,r=D[k],D[m]=f+r,D[l]=f-r,D[k]=D[j]-g,D[j]+=g;else for(K=I;B>K;K+=J)j=K,k=j+c,l=k+c,m=l+c,f=D[l]+D[m],D[m]-=D[l],D[l]=D[j]-f,D[j]+=f;I=(J<<1)-b,J<<=2}while(B>I);w=E/b;for(var L=1;d>L;L++){x=L*w,t=Math.sin(x),s=Math.cos(x),u=4*s*(s*s-.75),v=4*t*(.75-t*t),I=0,J=b<<1;do{for(K=I;B>K;K+=J)j=K+L,k=j+c,l=k+c,m=l+c,n=K+c-L,o=n+c,p=o+c,q=p+c,g=D[p]*s-D[l]*t,f=D[p]*t+D[l]*s,i=D[q]*u-D[m]*v,h=D[q]*v+D[m]*u,r=g-i,g+=i,i=r,D[q]=g+D[o],D[l]=g-D[o],r=h-f,f+=h,h=r,D[m]=h+D[k],D[p]=h-D[k],D[o]=D[j]-f,D[j]+=f,D[k]=i+D[n],D[n]-=i;I=(J<<1)-b,J<<=2}while(B>I)}}for(;--G;)y=D[G],z=D[B-G-1],A=H*F(y*y+z*z),A>this.peak&&(this.peakBand=G,this.peak=A),C[G]=A;return C[0]=H*D[0],C},Sampler.prototype.applyEnvelope=function(){return this.envelope.process(this.signal),this.signal},Sampler.prototype.generate=function(){for(var a=(this.frameCount*this.bufferSize,this.playEnd*this.samples.length-this.playStart*this.samples.length),b=this.playStart*this.samples.length,c=this.playEnd*this.samples.length,d=0;d<this.bufferSize;d++){switch(this.loopMode){case DSP.OFF:this.playhead=Math.round(this.samplesProcessed*this.step+b),this.signal[d]=this.playhead<this.playEnd*this.samples.length?this.samples[this.playhead]*this.amplitude:0;break;case DSP.FW:this.playhead=Math.round(this.samplesProcessed*this.step%a+b),this.playhead<this.playEnd*this.samples.length&&(this.signal[d]=this.samples[this.playhead]*this.amplitude);break;case DSP.BW:this.playhead=c-Math.round(this.samplesProcessed*this.step%a),this.playhead<this.playEnd*this.samples.length&&(this.signal[d]=this.samples[this.playhead]*this.amplitude);break;case DSP.FWBW:this.playhead=Math.floor(this.samplesProcessed*this.step/a)%2===0?Math.round(this.samplesProcessed*this.step%a+b):c-Math.round(this.samplesProcessed*this.step%a),this.playhead<this.playEnd*this.samples.length&&(this.signal[d]=this.samples[this.playhead]*this.amplitude)}this.samplesProcessed++}return this.frameCount++,this.signal},Sampler.prototype.setFreq=function(a){var b=this.samplesProcessed*this.step;this.frequency=a,this.step=this.frequency/this.rootFrequency,this.samplesProcessed=Math.round(b/this.step)},Sampler.prototype.reset=function(){this.samplesProcessed=0,this.playhead=0},Oscillator.prototype.setAmp=function(a){if(!(a>=0&&1>=a))throw"Amplitude out of range (0..1).";this.amplitude=a},Oscillator.prototype.setFreq=function(a){this.frequency=a,this.cyclesPerSample=a/this.sampleRate},Oscillator.prototype.add=function(a){for(var b=0;b<this.bufferSize;b++)this.signal[b]+=a.signal[b];return this.signal},Oscillator.prototype.addSignal=function(a){for(var b=0;b<a.length&&!(b>=this.bufferSize);b++)this.signal[b]+=a[b];return this.signal},Oscillator.prototype.addEnvelope=function(a){this.envelope=a},Oscillator.prototype.applyEnvelope=function(){this.envelope.process(this.signal)},Oscillator.prototype.valueAt=function(a){return this.waveTable[a%this.waveTableLength]},Oscillator.prototype.generate=function(){for(var a,b=this.frameCount*this.bufferSize,c=this.waveTableLength*this.frequency/this.sampleRate,d=0;d<this.bufferSize;d++)a=Math.round((b+d)*c),this.signal[d]=this.waveTable[a%this.waveTableLength]*this.amplitude;return this.frameCount++,this.signal},Oscillator.Sine=function(a){return Math.sin(DSP.TWO_PI*a)},Oscillator.Square=function(a){return.5>a?1:-1},Oscillator.Saw=function(a){return 2*(a-Math.round(a))},Oscillator.Triangle=function(a){return 1-4*Math.abs(Math.round(a)-a)},Oscillator.Pulse=function(){},ADSR.prototype.noteOn=function(){this.samplesProcessed=0,this.sustainSamples=this.sustainLength*this.sampleRate,this.update()},ADSR.prototype.noteOff=function(){this.sustainSamples=this.samplesProcessed-this.decaySamples,this.update()},ADSR.prototype.processSample=function(a){var b=0;return this.samplesProcessed<=this.attack?b=0+1*((this.samplesProcessed-0)/(this.attack-0)):this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?b=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack)):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?b=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(b=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))),a*b},ADSR.prototype.value=function(){var a=0;return this.samplesProcessed<=this.attack?a=0+1*((this.samplesProcessed-0)/(this.attack-0)):this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay?a=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack)):this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain?a=this.sustainLevel:this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release&&(a=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))),a},ADSR.prototype.process=function(a){for(var b=0;b<a.length;b++)a[b]*=this.value(),this.samplesProcessed++;return a},ADSR.prototype.isActive=function(){return this.samplesProcessed>this.release||-1===this.samplesProcessed?!1:!0},ADSR.prototype.disable=function(){this.samplesProcessed=-1},IIRFilter.prototype.__defineGetter__("cutoff",function(){return this.func.cutoff}),IIRFilter.prototype.__defineGetter__("resonance",function(){return this.func.resonance}),IIRFilter.prototype.set=function(a,b){this.func.calcCoeff(a,b)},IIRFilter.prototype.process=function(a){this.func.process(a)},IIRFilter.prototype.addEnvelope=function(a){if(!(a instanceof ADSR))throw"Not an envelope.";this.func.addEnvelope(a)},IIRFilter.LP12=function(a,b,c){this.sampleRate=c,this.vibraPos=0,this.vibraSpeed=0,this.envelope=!1,this.calcCoeff=function(a,b){this.w=2*Math.PI*a/this.sampleRate,this.q=1-this.w/(2*(b+.5/(1+this.w))+this.w-2),this.r=this.q*this.q,this.c=this.r+1-2*Math.cos(this.w)*this.q,this.cutoff=a,this.resonance=b},this.calcCoeff(a,b),this.process=function(a){for(var b=0;b<a.length;b++)this.vibraSpeed+=(a[b]-this.vibraPos)*this.c,this.vibraPos+=this.vibraSpeed,this.vibraSpeed*=this.r,this.envelope?(a[b]=a[b]*(1-this.envelope.value())+this.vibraPos*this.envelope.value(),this.envelope.samplesProcessed++):a[b]=this.vibraPos}},IIRFilter.LP12.prototype.addEnvelope=function(a){this.envelope=a},IIRFilter2.prototype.process=function(a){for(var b,c,d=this.f,e=0;e<a.length;e++)b=a[e],d[3]=b-this.damp*d[2],d[0]=d[0]+this.freq*d[2],d[1]=d[3]-d[0],d[2]=this.freq*d[1]+d[2],c=.5*d[this.type],d[3]=b-this.damp*d[2],d[0]=d[0]+this.freq*d[2],d[1]=d[3]-d[0],d[2]=this.freq*d[1]+d[2],c+=.5*d[this.type],this.envelope?(a[e]=a[e]*(1-this.envelope.value())+c*this.envelope.value(),this.envelope.samplesProcessed++):a[e]=c},IIRFilter2.prototype.addEnvelope=function(a){if(!(a instanceof ADSR))throw"This is not an envelope.";this.envelope=a},IIRFilter2.prototype.set=function(a,b){this.calcCoeff(a,b)},WindowFunction.prototype.process=function(a){for(var b=a.length,c=0;b>c;c++)a[c]*=this.func(b,c,this.alpha);
return a},WindowFunction.Bartlett=function(a,b){return 2/(a-1)*((a-1)/2-Math.abs(b-(a-1)/2))},WindowFunction.BartlettHann=function(a,b){return.62-.48*Math.abs(b/(a-1)-.5)-.38*Math.cos(DSP.TWO_PI*b/(a-1))},WindowFunction.Blackman=function(a,b,c){var d=(1-c)/2,e=.5,f=c/2;return d-e*Math.cos(DSP.TWO_PI*b/(a-1))+f*Math.cos(4*Math.PI*b/(a-1))},WindowFunction.Cosine=function(a,b){return Math.cos(Math.PI*b/(a-1)-Math.PI/2)},WindowFunction.Gauss=function(a,b,c){return Math.pow(Math.E,-.5*Math.pow((b-(a-1)/2)/(c*(a-1)/2),2))},WindowFunction.Hamming=function(a,b){return.54-.46*Math.cos(DSP.TWO_PI*b/(a-1))},WindowFunction.Hann=function(a,b){return.5*(1-Math.cos(DSP.TWO_PI*b/(a-1)))},WindowFunction.Lanczos=function(a,b){var c=2*b/(a-1)-1;return Math.sin(Math.PI*c)/(Math.PI*c)},WindowFunction.Rectangular=function(){return 1},WindowFunction.Triangular=function(a,b){return 2/a*(a/2-Math.abs(b-(a-1)/2))},DSP.mag2db=function(a){for(var b=-120,c=Math.pow(10,b/20),d=Math.log,e=Math.max,f=Float32Array(a.length),g=0;g<a.length;g++)f[g]=20*d(e(a[g],c));return f},DSP.freqz=function(a,b,c){var d,e;if(!c)for(c=Float32Array(200),d=0;d<c.length;d++)c[d]=DSP.TWO_PI/c.length*d-Math.PI;var f=Float32Array(c.length),g=Math.sqrt,h=Math.cos,i=Math.sin;for(d=0;d<c.length;d++){var j={real:0,imag:0};for(e=0;e<a.length;e++)j.real+=a[e]*h(-e*c[d]),j.imag+=a[e]*i(-e*c[d]);var k={real:0,imag:0};for(e=0;e<b.length;e++)k.real+=b[e]*h(-e*c[d]),k.imag+=b[e]*i(-e*c[d]);f[d]=g(j.real*j.real+j.imag*j.imag)/g(k.real*k.real+k.imag*k.imag)}return f},MultiDelay.prototype.setDelayInSamples=function(a){this.delayInSamples=a,this.delayInputPointer=this.delayOutputPointer+a,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},MultiDelay.prototype.setMasterVolume=function(a){this.masterVolume=a},MultiDelay.prototype.setDelayVolume=function(a){this.delayVolume=a},MultiDelay.prototype.process=function(a){for(var b=new Float32Array(a.length),c=0;c<a.length;c++){var d=null===this.delayBufferSamples[this.delayOutputPointer]?0:this.delayBufferSamples[this.delayOutputPointer],e=d*this.delayVolume+a[c];this.delayBufferSamples[this.delayInputPointer]=e,b[c]=e*this.masterVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return b},SingleDelay.prototype.setDelayInSamples=function(a){this.delayInSamples=a,this.delayInputPointer=this.delayOutputPointer+a,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length)},SingleDelay.prototype.setDelayVolume=function(a){this.delayVolume=a},SingleDelay.prototype.process=function(a){for(var b=new Float32Array(a.length),c=0;c<a.length;c++){this.delayBufferSamples[this.delayInputPointer]=a[c];var d=this.delayBufferSamples[this.delayOutputPointer];b[c]=d*this.delayVolume,this.delayInputPointer++,this.delayInputPointer>=this.delayBufferSamples.length-1&&(this.delayInputPointer=0),this.delayOutputPointer++,this.delayOutputPointer>=this.delayBufferSamples.length-1&&(this.delayOutputPointer=0)}return b},Reverb.prototype.setDelayInSamples=function(a){this.delayInSamples=a;var b,c;for(b=0;b<this.NR_OF_SINGLEDELAYS;b++)c=1+b/7,this.singleDelays[b].setDelayInSamples(Math.round(this.delayInSamples*c));for(b=0;b<this.NR_OF_MULTIDELAYS;b++)c=1+b/10,this.multiDelays[b].setDelayInSamples(Math.round(this.delayInSamples*c))},Reverb.prototype.setMasterVolume=function(a){this.masterVolume=a},Reverb.prototype.setMixVolume=function(a){this.mixVolume=a},Reverb.prototype.setDelayVolume=function(a){this.delayVolume=a;var b;for(b=0;b<this.NR_OF_SINGLEDELAYS;b++)this.singleDelays[b].setDelayVolume(this.delayVolume);for(b=0;b<this.NR_OF_MULTIDELAYS;b++)this.multiDelays[b].setDelayVolume(this.delayVolume)},Reverb.prototype.setDampFrequency=function(a){this.dampFrequency=a,this.LOWPASSL.set(a,0),this.LOWPASSR.set(a,0)},Reverb.prototype.process=function(a){var b=new Float32Array(a.length),c=DSP.deinterleave(a);this.LOWPASSL.process(c[DSP.LEFT]),this.LOWPASSR.process(c[DSP.RIGHT]);var d,e=DSP.interleave(c[DSP.LEFT],c[DSP.RIGHT]);for(d=0;d<this.NR_OF_MULTIDELAYS;d++)b=DSP.mixSampleBuffers(b,this.multiDelays[d].process(e),2%d===0,this.NR_OF_MULTIDELAYS);var f=new Float32Array(b.length);for(d=0;d<this.NR_OF_SINGLEDELAYS;d++)f=DSP.mixSampleBuffers(f,this.singleDelays[d].process(b),2%d===0,1);for(d=0;d<f.length;d++)f[d]*=this.mixVolume;for(b=DSP.mixSampleBuffers(f,a,0,1),d=0;d<b.length;d++)b[d]*=this.masterVolume;return b};var AudioSignUtil={hex2bin:function(a,b){for(var c="",d={0:"0000",1:"0001",2:"0010",3:"0011",4:"0100",5:"0101",6:"0110",7:"0111",8:"1000",9:"1001",a:"1010",b:"1011",c:"1100",d:"1101",e:"1110",f:"1111",A:"1010",B:"1011",C:"1100",D:"1101",E:"1110",F:"1111"},e=0;e<a.length;e++)c+=d[a[e]];for(;b&&c.length<b;)c="0"+c;return c},bin2hex:function(a,b){for(var c="",d=0;d<a.length;d+=4){var e=a.substring(d,d+4),f=parseInt(e,2);c+=f.toString(16)}for(;b&&c.length<b/4;)c="0"+c;return c},randomBinary:function(a){for(var b="",c=0;a>c;c++)b+=Math.round(1*Math.random());return b},hex2a:function(a){for(var b=a.toString(),c="",d=0;d<b.length;d+=2)c+=String.fromCharCode(parseInt(b.substr(d,2),16));return c}},AudioSignBroadcaster=function(a){var b=this;a=a||{};var c=a.size||160,d=a.step||15,e=a.blink||{cycle:1e3,active:300},f=a.baseFrequency||18600-d*(c+8);if(this.binaryId=AudioSignUtil.hex2bin(a.id||AudioSignUtil.bin2hex(AudioSignUtil.randomBinary(c)),c),this.binaryId.indexOf(void 0)>=0)throw"Invalid Id. Id must be a hex string.";this.id=AudioSignUtil.bin2hex(this.binaryId),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioSignAudioContext=window.audioSignAudioContext||new window.AudioContext,this._startBuffer=function(){b._sound=audioSignAudioContext.createBufferSource(),b._sound.loop=!0,b._gainNode=audioSignAudioContext.createGain(),b._sound.connect(b._gainNode),b._gainNode.connect(audioSignAudioContext.destination);for(var a=1*audioSignAudioContext.sampleRate,g=audioSignAudioContext.createBuffer(1,a,audioSignAudioContext.sampleRate),h=g.getChannelData(0),i=0,j=0;c>j;j++)if(this.binaryId[j]>0){i+=1;for(var k=0;a>k;k++)h[k]+=Math.sin(2*Math.PI*(f+j*d)*k/audioSignAudioContext.sampleRate)}for(var l=crc.crc8(b.id).toString(16),m=AudioSignUtil.hex2bin(l,8),j=0;j<m.length;j++)if(m[j]>0){i+=1;for(var k=0;a>k;k++)h[k]+=Math.sin(2*Math.PI*(f+(j+c)*d)*k/audioSignAudioContext.sampleRate)}for(var j=0;a>j;j++)h[j]/=i;b._sound.buffer=g,b._sound.start(0),e&&(b._blinkInterval=setInterval(function(){b._gainNode.gain.value=1,b._blinkTimeout=setTimeout(function(){b._gainNode.gain.value=0},e.active)},e.cycle))}};AudioSignBroadcaster.prototype.start=function(){if("Started"==this._state)throw new Error("Already started");this._state="Started",this._startBuffer()},AudioSignBroadcaster.prototype.stop=function(){if("Started"!=this._state)throw new Error("Not started");clearInterval(this._blinkInterval),clearTimeout(this._blinkTimeout),this._sound.stop(),delete this._sound,delete this._gainNode,delete this._state};var AudioSignListener=function(a){var b=this;a=a||{};var c=a.size||160,d=a.step||15;b.bufferSize=8192;var e=18600-d*(c+8)||a.baseFrequency;this._listeners={},window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioSignAudioContext=window.audioSignAudioContext||new window.AudioContext;var f,g;this._reset=function(){f=[],g=void 0},this._emit=function(a,b){for(var c in this._listeners[a])this._listeners[a][c]&&this._listeners[a][c](b)},this._listenOnce=function(a){for(var f=a,h=[],i=0;2*(c+8)>i;i++){var j=Math.floor((e+i*d-c*d)/audioSignAudioContext.sampleRate*b.bufferSize);h.push(f[j])}h=h.sort(function(a,b){return a-b});var k=h[Math.floor(h.length/2-1)],l=(h[Math.floor(h.length/4-1)],h[Math.floor(h.length/4*3-1)]),m=h[h.length-1];average=k/18*17+m/18*1+l/18*0;for(var n=!0,o=[],i=0;c+8>i;i++){var j=Math.floor((e+i*d)/audioSignAudioContext.sampleRate*b.bufferSize);f[j]>average||f[j+1]>average?(n=!1,o.push(1)):o.push(0)}if(!n){var p=o.slice(0,c),q=o.slice(c,c+8),r=AudioSignUtil.bin2hex(p.join("")),s=crc.crc8(r),t=s.toString(16),u=AudioSignUtil.hex2bin(t,8),v=q.join("");if(u==v&&(g=g||[],p.toString()!=g.toString())){g=p;var w=AudioSignUtil.bin2hex(p.join(""));b._emit("candidate",w)}}}};AudioSignListener.prototype.on=function(a,b){this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b)},AudioSignListener.prototype.off=function(a,b){this._listeners[a]&&this._listeners[a].remove(b)},AudioSignListener.prototype.start=function(){function a(a){b._mediaStream=a,b._audioInput=audioSignAudioContext.createMediaStreamSource(b._mediaStream),b._scriptProcessorNode=audioSignAudioContext.createScriptProcessor(b.bufferSize,1,1),b._scriptProcessorNode.onaudioprocess=function(a){for(var c=a.inputBuffer.getChannelData(0),d=0;d<c.length;++d)c[d]*=WindowFunction.Hamming(c.length,d);b._fft.forward(c),b._listenOnce(b._fft.spectrum)},b._audioInput.connect(b._scriptProcessorNode),b._scriptProcessorNode.connect(audioSignAudioContext.destination),b._fft=new FFT(b.bufferSize,44100),b._emit("started")}if("Started"==this._state)throw new Error("Already started");this._reset(),this._state="Started";var b=this;navigator.getUserMedia({audio:{optional:[{echoCancellation:!1}]}},a,function(a){throw a})},AudioSignListener.prototype.stop=function(){if("Started"!=this._state)throw new Error("Not started");this._mediaStream.stop(),this._audioInput.disconnect(),this._scriptProcessorNode.disconnect(),delete this._mediaStream,delete this._audioInput,delete this._scriptProcessorNode,delete this._state,this._emit("stopped")},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var AudioSign={AudioSignBroadcaster:AudioSignBroadcaster,AudioSignListener:AudioSignListener};