<html>
  	<head>
	    <title>AudioSign Test</title>

	    <script src="../../lib/audiosignbroadcaster.js"></script>
	    <script src="../../lib/audiosignlistener.js"></script>
	    <script src="../../lib/util.js"></script>
  	</head>

  	<!-- Show what is broadcasted and what is listened	-->
	<body>
		<div>
			<div>
				<input type="text" id="idText"><button onclick="refresh()">Refresh</button>
			</div>
			<button id="broadcasterButton" onclick="toggleBroadcaster()">Start Broadcasting</button>
			<div id="broadcaster"></div>
		</div>
		<div>
			<button id="listenerButton" onclick="toggleListener()">Start Listening</button>
			<div id="listener"></div>
		</div>
	</body>


	<!-- Play and listen	-->
	<script>
		//	Listener init
		window.listener = new AudioSignListener();
		window.listener.on('candidate', function(x){
			document.getElementById('listener').innerHTML += "I am hearing " + x + "<br>" + AudioSignUtil.integerToBinaryArray(x, 32) + "<br>";
		});
		var listenerButton = document.getElementById('listenerButton');

		//	Broadcaster init
		window.broadcaster = new AudioSignBroadcaster({id: 2863311530});
		var broadcasterButton = document.getElementById('broadcasterButton');

		function toggleListener(){
			if (listenerButton.innerHTML == 'Start Listening'){
				window.listener.start();
				listenerButton.innerHTML = 'Stop Listening';
			} else {
				window.listener.stop();
				listenerButton.innerHTML = 'Start Listening';
				document.getElementById('listener').innerHTML += 'Stopped Listening<br>';
			}
		}

		//	Start broadcasting
		function toggleBroadcaster(){
			if (broadcasterButton.innerHTML == 'Start Broadcasting'){
				window.broadcaster.start();
				broadcasterButton.innerHTML = 'Stop Broadcasting';
				document.getElementById('broadcaster').innerHTML += "I am broadcasting " + window.broadcaster.id + "<br>" + AudioSignUtil.integerToBinaryArray(window.broadcaster.id, 32) + "<br>";
			} else {
				window.broadcaster.stop();
				broadcasterButton.innerHTML = 'Start Broadcasting';
				document.getElementById('broadcaster').innerHTML += 'Stopped Broadcasting<br>';
			}
		}

		//	Refresh
		function refresh(){
			window.broadcaster.stop();
			var broadcasterButton = document.getElementById('broadcasterButton');
			broadcasterButton.innerHTML = 'Start Broadcasting';
			var id = parseInt(document.getElementById('idText').value);
			window.broadcaster = new AudioSignBroadcaster({id: id});
			var broadcasterButton = document.getElementById('broadcasterButton');
			toggleBroadcaster();
		}
	</script>
</html>